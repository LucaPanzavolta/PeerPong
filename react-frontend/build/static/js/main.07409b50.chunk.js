(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,n,t){},102:function(e,n,t){},104:function(e,n,t){},106:function(e,n,t){},109:function(e,n,t){},111:function(e,n,t){"use strict";t.r(n);var a=t(0),o=t.n(a),c=t(46),r=t.n(c),i=t(20),s=t(32),l={socket:null,room:null},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,n=arguments.length>1?arguments[1]:void 0;switch(console.log("state",e),console.log("action",n),n.type){case"SOCKET":return Object(s.a)({},e,{socket:n.socket});case"ROOM":return Object(s.a)({},e,{room:n.room});default:return e}},u=t(14),m=t(114),f=t(113),v=t(2),p=t(3),g=t(5),h=t(4),b=t(6),E=t(21),k=t.n(E),O=(t(67),function(e){function n(){return Object(v.a)(this,n),Object(g.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(p.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"header"},o.a.createElement("h1",null,"PeerPong"),o.a.createElement("div",null,o.a.createElement("p",{id:"username"},"Alan Turing"),o.a.createElement("img",{id:"avatar",src:k.a,alt:"avatar"})))}}]),n}(a.Component)),j=function(e){function n(){return Object(v.a)(this,n),Object(g.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(p.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"received-content"},o.a.createElement("video",{id:"received-video",autoPlay:!0}))}}]),n}(a.Component),w=function(e){function n(){return Object(v.a)(this,n),Object(g.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(p.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"local-content"},o.a.createElement("video",{id:"local-video",autoPlay:!0,muted:!0}))}}]),n}(a.Component);t(70);var y=function(e){function n(){return Object(v.a)(this,n),Object(g.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(p.a)(n,[{key:"componentDidMount",value:function(){!function(){var e=!1,n=0,t=0,a=document.getElementById("canvas").getContext("2d"),o=document.getElementById("received-video");a.canvas.width=o.clientWidth,a.canvas.height=o.clientHeight,a.canvas.addEventListener("mousemove",function(a){console.log("in drawing");var o=document.getElementById("canvas").getContext("2d");e&&(o.beginPath(),o.moveTo(n,t),o.lineTo(a.offsetX,a.offsetY),o.strokeStyle="#ecf0f1",o.stroke(),n=a.offsetX,t=a.offsetY)}),a.canvas.addEventListener("mousedown",function(a){e=!0,n=a.offsetX,t=a.offsetY,console.log("coords",n," | ",t)}),a.canvas.addEventListener("mouseup",function(){return e=!1}),a.canvas.addEventListener("mouseout",function(){return e=!1}),window.addEventListener("resize",function(){var e=document.getElementById("canvas").getContext("2d"),n=document.getElementById("received-video");e.canvas.width=n.clientWidth,e.canvas.height=n.clientHeight})}()}},{key:"render",value:function(){return o.a.createElement("div",{id:"canvas-content"},o.a.createElement("canvas",{id:"canvas"}))}}]),n}(a.Component),C=t(9),x=t.n(C),S=t(11),T=t(48),I=function(e){var n=new Date;console.log("------------------------------------"),console.log("["+n.toLocaleTimeString()+"] "+e)};function R(){var e=document.getElementById("canvas").getContext("2d");e.fillStyle="#2c3e50",e.fillRect(0,0,e.canvas.width,e.canvas.height),I("Starting to read stream from canvas");var n=e.canvas.captureStream(25);console.log("canvas stream tracks",n.getTracks()),_(n.getTracks()[0])}function D(){return(D=Object(S.a)(x.a.mark(function e(){var n,t,a=arguments;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(a.length>0&&void 0!==a[0])||a[0],e.prev=1,I("Requesting webcam access..."),e.next=5,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:612,height:288}});case 5:t=e.sent,I("-- Local camera stream obtained"),document.getElementById("local-video").srcObject=t,n?(I("-- Adding tracks to the RTCPeerConnection"),t.getTracks().forEach(function(e){I("im a track"),U.addTrack(e,t)})):(I("-- Adding stream to the RTCPeerConnection"),U.addStream(t)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),Q(e.t0);case 14:case"end":return e.stop()}},e,this,[[1,11]])}))).apply(this,arguments)}function N(){return B.apply(this,arguments)}function B(){return(B=Object(S.a)(x.a.mark(function e(){var n;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I("Requesting screen access..."),e.next=4,navigator.getDisplayMedia({video:!0});case 4:n=e.sent,I("-- Local video screen stream obtained"),document.getElementById("local-video").srcObject=n,_(n.getTracks()[0]),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),Q(e.t0);case 14:case 15:case"end":return e.stop()}},e,this,[[0,11]])}))).apply(this,arguments)}function _(e){return L.apply(this,arguments)}function L(){return(L=Object(S.a)(x.a.mark(function e(n){var t,a;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!M){e.next=11;break}return I("-- adding new Screen video track to the RTCPeerConnection"),e.next=4,U.addTrack(n);case 4:return t=U.getSenders(),console.log("rtc senders",t),a=t.filter(function(e){return"video"===e.track.kind&&!e.track.label.includes("screen")})[0],console.log("sender to remove",a),I("-- removing old video track in the RTCPeerConnection"),e.next=11,U.removeTrack(a);case 11:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var P=t.n(T).a.connect("wss://codeworks-solo-project.herokuapp.com/");P.on("connect",function(){I("socket opened...")}),P.on("connect_error",function(e){I("Connection error to socket.io server...")}),P.on("join-room",function(e){switch(e){case"waiting-for-other-person":I(e);break;case"ready-for-videocall":I(e),W(),function(){D.apply(this,arguments)}();break;case"too-many-people":I(e);break;default:I("error of some sort with the rooms")}}),P.on("video-offer",function(e){I("i received an offer for videochat"),function(e){$.apply(this,arguments)}(e)}),P.on("video-answer",function(e){I("i received an answer for videochat"),function(e){I("Call recipient has accepted our call");var n=new RTCSessionDescription(e);U.setRemoteDescription(n).catch(ee)}(e)}),P.on("new-ice-candidate",function(e){I("i received a new ice candidate remotelily from other peer"),function(e){var e=new RTCIceCandidate(e);I("Adding received ICE candidate: "+JSON.stringify(e)),U.addIceCandidate(e).catch(ee)}(e)});var A=P,U=null,M=!1,X=0;function W(){I("Setting up a connection..."),U=new RTCPeerConnection({iceServers:[{urls:"turn:numb.viagenie.ca",username:"webrtc@live.com",credential:"muazkh"}]}),M=void 0!==U.addTrack,U.onnegotiationneeded=F,U.onicecandidate=K,U.onnremovestream=q,U.oniceconnectionstatechange=Y,U.onicegatheringstatechange=V,U.onsignalingstatechange=G,U.ondatachannel=ne,M?U.ontrack=H:U.onaddstream=J}function F(e){return z.apply(this,arguments)}function z(){return(z=Object(S.a)(x.a.mark(function e(n){var t;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=U._negotiating){e.next=2;break}return e.abrupt("return");case 2:return I("*** Negotiation needed"),U._negotiating=!0,e.prev=4,I("---\x3e Creating offer"),e.next=8,U.createOffer();case 8:return t=e.sent,console.log("im the offer",t),I("---\x3e Creating new description object to send to remote peer"),e.next=13,U.setLocalDescription(t);case 13:I("---\x3e Sending offer to remote peer"),A.emit("video-offer",U.localDescription),console.log("in negotiation needed myPeerConnection.localDescription",U.localDescription),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),ee(e.t0);case 21:return e.prev=21,U._negotiating=!1,e.finish(21);case 24:case"end":return e.stop()}},e,this,[[4,18,21,24]])}))).apply(this,arguments)}function H(e){I("*** Track event"),X++,console.log("NUMBER OF TRACKS IS ",X),document.getElementById("received-video").srcObject=e.streams[0]}function J(e){I("*** Stream added"),document.getElementById("received-video").srcObject=e.stream}function q(e){I("*** Stream removed"),Z()}function K(e){e.candidate&&(I("Outgoing ICE candidate: "+e.candidate.candidate),A.emit("new-ice-candidate",e.candidate))}function Y(e){switch(I("*** ICE connection state changed to "+U.iceConnectionState),U.iceConnectionState){case"closed":case"failed":case"disconnected":Z()}}function G(e){I("*** WebRTC signaling state changed to: "+U.signalingState),"closed"===U.signalingState&&Z()}function V(e){I("*** ICE gathering state changed to: "+U.iceGatheringState)}function Z(){var e=document.getElementById("received-video"),n=document.getElementById("local-video");I("Closing the call"),U&&(I("--\x3e Closing the peer connection"),U.onaddstream=null,U.ontrack=null,U.onremovestream=null,U.onnicecandidate=null,U.oniceconnectionstatechange=null,U.onsignalingstatechange=null,U.onicegatheringstatechange=null,U.onnotificationneeded=null,e.srcObject&&e.srcObject.getTracks().forEach(function(e){return e.stop()}),n.srcObject&&n.srcObject.getTracks().forEach(function(e){return e.stop()}),e.src=null,n.src=null,U.close(),U=null)}function $(){return($=Object(S.a)(x.a.mark(function e(n){var t,a,o,c;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,U){e.next=16;break}return console.log(" handle video offer msg when connection existst"),W(),t=new RTCSessionDescription(n),e.next=7,U.setRemoteDescription(t);case 7:return I("Setting up the local media stream..."),e.next=10,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:612,height:288}});case 10:a=e.sent,I("-- Local video stream obtained"),document.getElementById("local-video").srcObject=a,M?(I("-- Adding tracks to the RTCPeerConnection"),a.getTracks().forEach(function(e){return U.addTrack(e,a)})):(I("-- Adding stream to the RTCPeerConnection"),U.addStream(a)),e.next=20;break;case 16:return console.log("handle video offer message when connection exists"),o=new RTCSessionDescription(n),e.next=20,U.setRemoteDescription(o);case 20:return I("------\x3e Creating answer"),e.next=23,U.createAnswer();case 23:return c=e.sent,e.next=26,U.setLocalDescription(c);case 26:I("------\x3e Setting local description after creating answer"),A.emit("video-answer",U.localDescription),I("Sending answer packet back to other peer"),e.next=35;break;case 31:e.prev=31,e.t0=e.catch(0),console.log(e.t0),Q(e.t0);case 35:return e.prev=35,U._negotiating=!1,e.finish(35);case 38:case"end":return e.stop()}},e,this,[[0,31,35,38]])}))).apply(this,arguments)}function Q(e){switch(I("HANDLE GET USER MEDIA ERROR FUNCTION"),e.name){case"NotFoundError":alert("Unable to open your call because no camera and/or microphonewere found.");break;case"SecurityError":case"PermissionDeniedError":break;default:alert("Error opening your camera and/or microphone: "+e.message)}Z()}function ee(e){!function(e){var n=new Date;console.error("["+n.toLocaleTimeString()+"] "+e)}("Error "+e.name+": "+e.message)}function ne(e){console.log("DATA CHANNEL OPEN!");var n=e.channel;n.onopen=function(){console.log("receive channel on open")},n.onclose=function(){console.log("receive channel on close")},n.send("TU PUZZI!!!!!!!!!!!!!!")}function te(){document.getElementById("file-input").click(),console.log("buzzu",U)}function ae(){var e=document.getElementById("file-input").files[0];console.log("file to send",e),function(){var e=U.createDataChannel("sendChannel");e.onopen=oe,e.onclose=ce}()}function oe(){console.log("data channel on open callback")}function ce(){console.log("data channel on close callback")}var re=t(49),ie=t.n(re),se=t(50),le=t.n(se),de=t(51),ue=t.n(de),me=t(52),fe=t.n(me),ve=(t(98),function(e){function n(){return Object(v.a)(this,n),Object(g.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(p.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"toolbar"},o.a.createElement("input",{type:"file",id:"file-input",onChange:ae,style:{display:"none"}}),o.a.createElement("img",{className:"icons",src:ie.a,alt:"icon1",onClick:te}),o.a.createElement("img",{className:"icons",src:le.a,alt:"icon2"}),o.a.createElement("img",{className:"icons",src:ue.a,alt:"icon3"}),o.a.createElement("img",{className:"icons",src:fe.a,alt:"icon4"}))}}]),n}(a.Component)),pe=t(53),ge=t.n(pe),he=t(54),be=t.n(he),Ee=t(55),ke=t.n(Ee),Oe=(t(100),function(e){function n(){return Object(v.a)(this,n),Object(g.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(p.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"call-buttons"},o.a.createElement("div",{className:"round-bg",onClick:N},o.a.createElement("img",{className:"call-buttons",src:ge.a,alt:"Share your screen icon"})),o.a.createElement("div",{className:"round-bg",onClick:R},o.a.createElement("img",{className:"call-buttons",src:be.a,alt:"Share notes on a blackboard icon"})),o.a.createElement("div",{className:"round-bg",onClick:Z},o.a.createElement("img",{className:"call-buttons",src:ke.a,alt:"Close current call icon"})))}}]),n}(a.Component)),je=(t(102),function(e){function n(){return Object(v.a)(this,n),Object(g.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(p.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"video-container"},o.a.createElement(j,null),o.a.createElement(w,null),o.a.createElement(y,null),o.a.createElement(ve,null),o.a.createElement(Oe,null))}}]),n}(a.Component)),we=(t(104),function(e){function n(){return Object(v.a)(this,n),Object(g.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(p.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(O,null),o.a.createElement(je,null))}}]),n}(a.Component)),ye=Object(u.b)(function(e){return{socket:e.socket}},function(e){return{}})(we),Ce=t(112),xe=(t(106),function(e){function n(){var e,t;Object(v.a)(this,n);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(t=Object(g.a)(this,(e=Object(h.a)(n)).call.apply(e,[this].concat(o)))).readInputField=function(){var e=document.getElementById("room-name").value;A.emit("join-room",e)},t}return Object(b.a)(n,e),Object(p.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"join-room-wrapper"},o.a.createElement("div",{id:"join-room-form"},o.a.createElement("img",{id:"profile-photo",src:k.a,alt:"avatar"}),o.a.createElement("input",{id:"room-name",type:"text",placeholder:"Which room do you wanna join?",required:!0}),o.a.createElement(Ce.a,{to:"/videochat"},o.a.createElement("button",{id:"join",onClick:this.readInputField},"Join room"))))}}]),n}(a.Component)),Se=Object(u.b)(function(e){return{socket:e.socket}},function(e){return{updateSocketInStore:function(n){return e({type:"SOCKET",socket:n})},updateRoomNameInStore:function(n){return e({type:"ROOM",room:n})}}})(xe),Te=function(e){var n=e.store;return o.a.createElement(u.a,{store:n},o.a.createElement(m.a,null,o.a.createElement("div",{id:"routes-wrapper"},o.a.createElement(f.a,{exact:!0,path:"/",component:Se}),o.a.createElement(f.a,{path:"/videochat",component:ye}))))};t(109),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ie=Object(i.b)(d,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());r.a.render(o.a.createElement(Te,{store:Ie}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},21:function(e,n,t){e.exports=t.p+"static/media/man.dabcdaa2.svg"},49:function(e,n,t){e.exports=t.p+"static/media/001-conference.77761e56.svg"},50:function(e,n,t){e.exports=t.p+"static/media/010-mail.68722792.svg"},51:function(e,n,t){e.exports=t.p+"static/media/013-videocall-1.6b6feeaf.svg"},52:function(e,n,t){e.exports=t.p+"static/media/024-megaphone.2a0a42f8.svg"},53:function(e,n,t){e.exports=t.p+"static/media/share-screen.1219b614.svg"},54:function(e,n,t){e.exports=t.p+"static/media/blackboard.781bd799.svg"},55:function(e,n,t){e.exports=t.p+"static/media/close-call.973863ac.svg"},58:function(e,n,t){e.exports=t(111)},67:function(e,n,t){},70:function(e,n,t){},95:function(e,n){},98:function(e,n,t){}},[[58,2,1]]]);
//# sourceMappingURL=main.07409b50.chunk.js.map