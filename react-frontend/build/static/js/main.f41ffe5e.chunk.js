(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,n,t){},102:function(e,n,t){},104:function(e,n,t){},106:function(e,n,t){},109:function(e,n,t){},111:function(e,n,t){"use strict";t.r(n);var a=t(0),o=t.n(a),c=t(46),r=t.n(c),i=t(20),s=t(32),l={socket:null,room:null},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,n=arguments.length>1?arguments[1]:void 0;switch(console.log("state",e),console.log("action",n),n.type){case"SOCKET":return Object(s.a)({},e,{socket:n.socket});case"ROOM":return Object(s.a)({},e,{room:n.room});default:return e}},u=t(14),m=t(114),f=t(113),v=t(2),g=t(3),p=t(5),h=t(4),b=t(6),E=t(21),O=t.n(E),k=(t(67),function(e){function n(){return Object(v.a)(this,n),Object(p.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(g.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"header"},o.a.createElement("h1",null,"PeerPong"),o.a.createElement("div",null,o.a.createElement("p",{id:"username"},"Alan Turing"),o.a.createElement("img",{id:"avatar",src:O.a,alt:"avatar"})))}}]),n}(a.Component)),w=function(e){function n(){return Object(v.a)(this,n),Object(p.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(g.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"received-content"},o.a.createElement("video",{id:"received-video",autoPlay:!0}))}}]),n}(a.Component),j=function(e){function n(){return Object(v.a)(this,n),Object(p.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(g.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"local-content"},o.a.createElement("video",{id:"local-video",autoPlay:!0,muted:!0}))}}]),n}(a.Component);t(70);var y=function(e){function n(){return Object(v.a)(this,n),Object(p.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(g.a)(n,[{key:"componentDidMount",value:function(){!function(){var e=!1,n=0,t=0,a=document.getElementById("canvas").getContext("2d"),o=document.getElementById("received-video");a.canvas.width=o.clientWidth,a.canvas.height=o.clientHeight,a.canvas.addEventListener("mousemove",function(a){console.log("in drawing");var o=document.getElementById("canvas").getContext("2d");e&&(o.beginPath(),o.moveTo(n,t),o.lineTo(a.offsetX,a.offsetY),o.strokeStyle="#ecf0f1",o.stroke(),n=a.offsetX,t=a.offsetY)}),a.canvas.addEventListener("mousedown",function(a){e=!0,n=a.offsetX,t=a.offsetY,console.log("coords",n," | ",t)}),a.canvas.addEventListener("mouseup",function(){return e=!1}),a.canvas.addEventListener("mouseout",function(){return e=!1}),window.addEventListener("resize",function(){var e=document.getElementById("canvas").getContext("2d"),n=document.getElementById("received-video");e.canvas.width=n.clientWidth,e.canvas.height=n.clientHeight})}()}},{key:"render",value:function(){return o.a.createElement("div",{id:"canvas-content"},o.a.createElement("canvas",{id:"canvas"}))}}]),n}(a.Component),C=t(9),x=t.n(C),S=t(11),T=t(48),I=t.n(T),R=function(e){var n=new Date;console.log("------------------------------------"),console.log("["+n.toLocaleTimeString()+"] "+e)};function D(){var e=document.getElementById("canvas").getContext("2d");e.fillStyle="#2c3e50",e.fillRect(0,0,e.canvas.width,e.canvas.height),R("Starting to read stream from canvas");var n=e.canvas.captureStream(25);console.log("canvas stream tracks",n.getTracks()),L(n.getTracks()[0])}function N(){return(N=Object(S.a)(x.a.mark(function e(){var n,t,a=arguments;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(a.length>0&&void 0!==a[0])||a[0],e.prev=1,R("Requesting webcam access..."),e.next=5,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:612,height:288}});case 5:t=e.sent,R("-- Local camera stream obtained"),document.getElementById("local-video").srcObject=t,n?(R("-- Adding tracks to the RTCPeerConnection"),t.getTracks().forEach(function(e){R("im a track"),X.addTrack(e,t)})):(R("-- Adding stream to the RTCPeerConnection"),X.addStream(t)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),ne(e.t0);case 14:case"end":return e.stop()}},e,this,[[1,11]])}))).apply(this,arguments)}function B(){return _.apply(this,arguments)}function _(){return(_=Object(S.a)(x.a.mark(function e(){var n;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R("Requesting screen access..."),e.next=4,navigator.getDisplayMedia({video:!0});case 4:n=e.sent,R("-- Local video screen stream obtained"),document.getElementById("local-video").srcObject=n,L(n.getTracks()[0]),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),ne(e.t0);case 14:case 15:case"end":return e.stop()}},e,this,[[0,11]])}))).apply(this,arguments)}function L(e){return P.apply(this,arguments)}function P(){return(P=Object(S.a)(x.a.mark(function e(n){var t,a;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!W){e.next=11;break}return R("-- adding new Screen video track to the RTCPeerConnection"),e.next=4,X.addTrack(n);case 4:return t=X.getSenders(),console.log("rtc senders",t),a=t.filter(function(e){return"video"===e.track.kind&&!e.track.label.includes("screen")})[0],console.log("sender to remove",a),R("-- removing old video track in the RTCPeerConnection"),e.next=11,X.removeTrack(a);case 11:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var A=window.location.hostname,U=I.a.connect("ws://".concat(A,":4000"));U.on("connect",function(){R("socket opened...")}),U.on("connect_error",function(e){R("Connection error to socket.io server...")}),U.on("join-room",function(e){switch(e){case"waiting-for-other-person":R(e);break;case"ready-for-videocall":R(e),z(),function(){N.apply(this,arguments)}();break;case"too-many-people":R(e);break;default:R("error of some sort with the rooms")}}),U.on("video-offer",function(e){R("i received an offer for videochat"),function(e){ee.apply(this,arguments)}(e)}),U.on("video-answer",function(e){R("i received an answer for videochat"),function(e){R("Call recipient has accepted our call");var n=new RTCSessionDescription(e);X.setRemoteDescription(n).catch(te)}(e)}),U.on("new-ice-candidate",function(e){R("i received a new ice candidate remotelily from other peer"),function(e){var e=new RTCIceCandidate(e);R("Adding received ICE candidate: "+JSON.stringify(e)),X.addIceCandidate(e).catch(te)}(e)});var M=U,X=null,W=!1,F=0;function z(){R("Setting up a connection..."),X=new RTCPeerConnection({iceServers:[{urls:"turn:numb.viagenie.ca",username:"webrtc@live.com",credential:"muazkh"}]}),W=void 0!==X.addTrack,X.onnegotiationneeded=H,X.onicecandidate=G,X.onnremovestream=Y,X.oniceconnectionstatechange=V,X.onicegatheringstatechange=$,X.onsignalingstatechange=Z,X.ondatachannel=ae,W?X.ontrack=q:X.onaddstream=K}function H(e){return J.apply(this,arguments)}function J(){return(J=Object(S.a)(x.a.mark(function e(n){var t;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=X._negotiating){e.next=2;break}return e.abrupt("return");case 2:return R("*** Negotiation needed"),X._negotiating=!0,e.prev=4,R("---\x3e Creating offer"),e.next=8,X.createOffer();case 8:return t=e.sent,console.log("im the offer",t),R("---\x3e Creating new description object to send to remote peer"),e.next=13,X.setLocalDescription(t);case 13:R("---\x3e Sending offer to remote peer"),M.emit("video-offer",X.localDescription),console.log("in negotiation needed myPeerConnection.localDescription",X.localDescription),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),te(e.t0);case 21:return e.prev=21,X._negotiating=!1,e.finish(21);case 24:case"end":return e.stop()}},e,this,[[4,18,21,24]])}))).apply(this,arguments)}function q(e){R("*** Track event"),F++,console.log("NUMBER OF TRACKS IS ",F),document.getElementById("received-video").srcObject=e.streams[0]}function K(e){R("*** Stream added"),document.getElementById("received-video").srcObject=e.stream}function Y(e){R("*** Stream removed"),Q()}function G(e){e.candidate&&(R("Outgoing ICE candidate: "+e.candidate.candidate),M.emit("new-ice-candidate",e.candidate))}function V(e){switch(R("*** ICE connection state changed to "+X.iceConnectionState),X.iceConnectionState){case"closed":case"failed":case"disconnected":Q()}}function Z(e){R("*** WebRTC signaling state changed to: "+X.signalingState),"closed"===X.signalingState&&Q()}function $(e){R("*** ICE gathering state changed to: "+X.iceGatheringState)}function Q(){var e=document.getElementById("received-video"),n=document.getElementById("local-video");R("Closing the call"),X&&(R("--\x3e Closing the peer connection"),X.onaddstream=null,X.ontrack=null,X.onremovestream=null,X.onnicecandidate=null,X.oniceconnectionstatechange=null,X.onsignalingstatechange=null,X.onicegatheringstatechange=null,X.onnotificationneeded=null,e.srcObject&&e.srcObject.getTracks().forEach(function(e){return e.stop()}),n.srcObject&&n.srcObject.getTracks().forEach(function(e){return e.stop()}),e.src=null,n.src=null,X.close(),X=null)}function ee(){return(ee=Object(S.a)(x.a.mark(function e(n){var t,a,o,c;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,X){e.next=16;break}return console.log(" handle video offer msg when connection existst"),z(),t=new RTCSessionDescription(n),e.next=7,X.setRemoteDescription(t);case 7:return R("Setting up the local media stream..."),e.next=10,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:612,height:288}});case 10:a=e.sent,R("-- Local video stream obtained"),document.getElementById("local-video").srcObject=a,W?(R("-- Adding tracks to the RTCPeerConnection"),a.getTracks().forEach(function(e){return X.addTrack(e,a)})):(R("-- Adding stream to the RTCPeerConnection"),X.addStream(a)),e.next=20;break;case 16:return console.log("handle video offer message when connection exists"),o=new RTCSessionDescription(n),e.next=20,X.setRemoteDescription(o);case 20:return R("------\x3e Creating answer"),e.next=23,X.createAnswer();case 23:return c=e.sent,e.next=26,X.setLocalDescription(c);case 26:R("------\x3e Setting local description after creating answer"),M.emit("video-answer",X.localDescription),R("Sending answer packet back to other peer"),e.next=35;break;case 31:e.prev=31,e.t0=e.catch(0),console.log(e.t0),ne(e.t0);case 35:return e.prev=35,X._negotiating=!1,e.finish(35);case 38:case"end":return e.stop()}},e,this,[[0,31,35,38]])}))).apply(this,arguments)}function ne(e){switch(R("HANDLE GET USER MEDIA ERROR FUNCTION"),e.name){case"NotFoundError":alert("Unable to open your call because no camera and/or microphonewere found.");break;case"SecurityError":case"PermissionDeniedError":break;default:alert("Error opening your camera and/or microphone: "+e.message)}Q()}function te(e){!function(e){var n=new Date;console.error("["+n.toLocaleTimeString()+"] "+e)}("Error "+e.name+": "+e.message)}function ae(e){console.log("DATA CHANNEL OPEN!");var n=e.channel;n.onopen=function(){console.log("receive channel on open")},n.onclose=function(){console.log("receive channel on close")},n.send("TU PUZZI!!!!!!!!!!!!!!")}function oe(){document.getElementById("file-input").click(),console.log("buzzu",X)}function ce(){var e=document.getElementById("file-input").files[0];console.log("file to send",e),function(){var e=X.createDataChannel("sendChannel");e.onopen=re,e.onclose=ie}()}function re(){console.log("data channel on open callback")}function ie(){console.log("data channel on close callback")}var se=t(49),le=t.n(se),de=t(50),ue=t.n(de),me=t(51),fe=t.n(me),ve=t(52),ge=t.n(ve),pe=(t(98),function(e){function n(){return Object(v.a)(this,n),Object(p.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(g.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"toolbar"},o.a.createElement("input",{type:"file",id:"file-input",onChange:ce,style:{display:"none"}}),o.a.createElement("img",{className:"icons",src:le.a,alt:"icon1",onClick:oe}),o.a.createElement("img",{className:"icons",src:ue.a,alt:"icon2"}),o.a.createElement("img",{className:"icons",src:fe.a,alt:"icon3"}),o.a.createElement("img",{className:"icons",src:ge.a,alt:"icon4"}))}}]),n}(a.Component)),he=t(53),be=t.n(he),Ee=t(54),Oe=t.n(Ee),ke=t(55),we=t.n(ke),je=(t(100),function(e){function n(){return Object(v.a)(this,n),Object(p.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(g.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"call-buttons"},o.a.createElement("div",{className:"round-bg",onClick:B},o.a.createElement("img",{className:"call-buttons",src:be.a,alt:"Share your screen icon"})),o.a.createElement("div",{className:"round-bg",onClick:D},o.a.createElement("img",{className:"call-buttons",src:Oe.a,alt:"Share notes on a blackboard icon"})),o.a.createElement("div",{className:"round-bg",onClick:Q},o.a.createElement("img",{className:"call-buttons",src:we.a,alt:"Close current call icon"})))}}]),n}(a.Component)),ye=(t(102),function(e){function n(){return Object(v.a)(this,n),Object(p.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(g.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"video-container"},o.a.createElement(w,null),o.a.createElement(j,null),o.a.createElement(y,null),o.a.createElement(pe,null),o.a.createElement(je,null))}}]),n}(a.Component)),Ce=(t(104),function(e){function n(){return Object(v.a)(this,n),Object(p.a)(this,Object(h.a)(n).apply(this,arguments))}return Object(b.a)(n,e),Object(g.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(k,null),o.a.createElement(ye,null))}}]),n}(a.Component)),xe=Object(u.b)(function(e){return{socket:e.socket}},function(e){return{}})(Ce),Se=t(112),Te=(t(106),function(e){function n(){var e,t;Object(v.a)(this,n);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(t=Object(p.a)(this,(e=Object(h.a)(n)).call.apply(e,[this].concat(o)))).readInputField=function(){var e=document.getElementById("room-name").value;M.emit("join-room",e)},t}return Object(b.a)(n,e),Object(g.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{id:"join-room-wrapper"},o.a.createElement("div",{id:"join-room-form"},o.a.createElement("img",{id:"profile-photo",src:O.a,alt:"avatar"}),o.a.createElement("input",{id:"room-name",type:"text",placeholder:"Which room do you wanna join?",required:!0}),o.a.createElement(Se.a,{to:"/videochat"},o.a.createElement("button",{id:"join",onClick:this.readInputField},"Join room"))))}}]),n}(a.Component)),Ie=Object(u.b)(function(e){return{socket:e.socket}},function(e){return{updateSocketInStore:function(n){return e({type:"SOCKET",socket:n})},updateRoomNameInStore:function(n){return e({type:"ROOM",room:n})}}})(Te),Re=function(e){var n=e.store;return o.a.createElement(u.a,{store:n},o.a.createElement(m.a,null,o.a.createElement("div",{id:"routes-wrapper"},o.a.createElement(f.a,{exact:!0,path:"/",component:Ie}),o.a.createElement(f.a,{path:"/videochat",component:xe}))))};t(109),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var De=Object(i.b)(d,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());r.a.render(o.a.createElement(Re,{store:De}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},21:function(e,n,t){e.exports=t.p+"static/media/man.dabcdaa2.svg"},49:function(e,n,t){e.exports=t.p+"static/media/001-conference.77761e56.svg"},50:function(e,n,t){e.exports=t.p+"static/media/010-mail.68722792.svg"},51:function(e,n,t){e.exports=t.p+"static/media/013-videocall-1.6b6feeaf.svg"},52:function(e,n,t){e.exports=t.p+"static/media/024-megaphone.2a0a42f8.svg"},53:function(e,n,t){e.exports=t.p+"static/media/share-screen.1219b614.svg"},54:function(e,n,t){e.exports=t.p+"static/media/blackboard.781bd799.svg"},55:function(e,n,t){e.exports=t.p+"static/media/close-call.973863ac.svg"},58:function(e,n,t){e.exports=t(111)},67:function(e,n,t){},70:function(e,n,t){},95:function(e,n){},98:function(e,n,t){}},[[58,2,1]]]);
//# sourceMappingURL=main.f41ffe5e.chunk.js.map